'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

const vueDemi = require('vue-demi');
const pinia = require('pinia');

function createTestingPinia({
  initialState = {},
  plugins = [],
  stubActions = true,
  stubPatch = false,
  fakeApp = false,
  createSpy: _createSpy
} = {}) {
  const pinia$1 = pinia.createPinia();
  pinia$1.use(({ store }) => {
    if (initialState[store.$id]) {
      store.$patch(initialState[store.$id]);
    }
  });
  plugins.forEach((plugin) => pinia$1.use(plugin));
  const createSpy = _createSpy || typeof jest !== "undefined" && jest.fn;
  if (!createSpy) {
    throw new Error("You must configure the `createSpy` option.");
  }
  pinia$1.use(({ store, options }) => {
    Object.keys(options.actions).forEach((action) => {
      store[action] = stubActions ? createSpy() : createSpy(store[action]);
    });
    store.$patch = stubPatch ? createSpy() : createSpy(store.$patch);
  });
  if (fakeApp) {
    const app = vueDemi.createApp({});
    app.use(pinia$1);
  }
  pinia$1._testing = true;
  pinia.setActivePinia(pinia$1);
  Object.defineProperty(pinia$1, "app", {
    configurable: true,
    enumerable: true,
    get() {
      return this._a;
    }
  });
  return pinia$1;
}

exports.createTestingPinia = createTestingPinia;
